<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>♞</text></svg>">
    <title>LLM Chess Leaderboard</title>
    <style>
        @font-face {
            font-family: 'Web IBM VGA 8x16';
            font-style: normal;
            font-weight: 400;
            src: url(web_ibm_vga_8x16.woff) format('woff');
        }

        body {
            background-color: #0000AA;
            color: #FFFFFF;
            font-family: "Web IBM VGA 8x16";
            text-align: center;
            margin: 0;
            font-size: 20px;
            overflow-y: scroll;
        }

        div.center {
            width: 1000px;
            margin: auto;
        }

        h1 {
            margin-bottom: 20px;
        }

        p.intro {
            display: block;
            width: 700px;
            margin:auto;
            text-align: justify;
            padding-bottom: 40px;
        }

        .button-container {
            display: flex;
            justify-content: center;
            margin-top: 40px;
            margin-bottom: 20px;
        }

        button {
            width: 160px;
            margin: 0 5px;
            padding: 5px;
            background-color: #C0C0C0;
            color: #000000;
            border: 1px solid #808080;
            font-family: "Web IBM VGA 8x16";
            font-size: 20px;
            position: relative;
            cursor: pointer;
        }

        button::after {
            content: '';
            position: absolute;
            top: 8px;
            left: 8px;
            width: 100%;
            height: 100%;
            background-color: #000000;
            z-index: -1;
        }

        button.selected {
            background-color: green;
            color: #FFFFFF;
            top: 1px;
            left: 1px;
        }

        button:hover {
            background-color: #808080;
            color: #FFFFFF;
            top: 2px;
            left: 2px;
        }

        .pane{
            padding-top: 20px;
        }

        pre.title {
            font-size: 16px;
            scale: 1.0;
            padding-top: 50px;
        }

        pre.title-narrow {
            display: none;
        }

        pre.board {
            font-family: 'Courier New', Courier, monospace;
            font-size: 30px;
            width: 300px;
            height: 300px;
            background-color: black;
            opacity: 0.85;
            line-height: 37px;
            padding: 0;
            margin: 0;
        }

        div.board {
            width: 300px;
            height: 300px;
            border: solid white 5px;
            margin-top: 20px;
            margin-bottom: 20px;
            margin-left: auto;
            margin-right: auto;
            position: relative;
        }

        .game-over {
            position: absolute;
            top: 0;
            left: 0;

            background-color: rgba(0, 0, 0, .9);
            width: 300px;
            height: 300px;
            text-align: center;
            display: none;
        }

        @keyframes blink {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0;
            }
        }
        
        .game-over p {
            color: red;
            font-size: 40px;
            font-weight: bold;
            animation: blink 1s infinite;
        }

        .game-over span {
            text-align: left;
            display: inline-flex;
        }

        p, pre {
            opacity: 0.75;
        }

        .table-container {
            overflow-x: auto;
            padding: 0 20px;
        }

        table {
            margin-bottom: 40px;
            min-width: 700px;
            width: 100%;
            border-collapse: collapse;
        }
        
        td, th {
            padding: 10px;
            font-weight: lighter;
            text-align: left;
        }

        th {
            cursor: pointer;
        }

        td {
            border-top: 1px solid;
            opacity: 0.75;
        }

        table tbody tr:nth-last-child(-n+3) {
            color: greenyellow;
        }

        .gh{
            position: absolute;
            top: 40px;
            image-rendering: crisp-edges;
        }
        /* Responsive styles for mobile devices */
        @media (max-width: 768px) {
            body {
                font-size: 18px;
            }

            div.center {
                width: 90%;
            }

            h1 {
                font-size: 24px;
            }

            p.intro {
                width: 100%;
            }

            div.board {
                scale: 0.9;
            }

            button {
                width: 140px;
                font-size: 18px;
            }

            pre.title {
                display: none;
            }

            pre.title-narrow {
                display: block;
                font-size: 10px;
                padding-top: 20px;
                padding-bottom: 20px;
                opacity: 1.0;
                max-width: 325px;
                overflow-x: hidden;
            }

            td, th {
                padding: 8px;
            }

            .button-container {
                flex-direction: column;
                align-items: center;
            }

            .button-container button {
                margin: 5px 0;
            }
        }
    </style>
    <script>
            data = `
Player,total_games,player_wins,opponent_wins,draws,player_wins_percent,player_draws_percent,total_moves,player_wrong_actions,player_wrong_moves,player_avg_material,opponent_avg_material,material_diff_player_llm_minus_opponent,material_diff_player_minus_opponent_per_1000moves,wrong_actions_per_1000moves,wrong_moves_per_1000moves,average_moves,completion_tokens_black_per_move
anthropic.claude-v3-5-sonnet,30,0,8,22,0.000,73.333,5148,0,12,13.24,20.60,-7.36,-1.43012,0.00,2.33,171.60,81.07479
anthropic.claude-v3-haiku,30,0,30,0,0.000,0.000,1020,6,4,34.34,35.89,-1.55,-1.52057,5.88,3.92,34.00,205.71176
gemini-1.5-flash-001,30,0,20,10,0.000,33.333,2524,18,36,16.69,31.44,-14.75,-5.84296,7.13,14.26,84.13,19.91482
gemini-1.5-pro-preview-0409,30,0,19,11,0.000,36.667,2558,14,61,22.09,28.23,-6.15,-2.40366,5.47,23.85,85.27,13.40774
gemma-2-27b-it@q6_k_l,30,0,22,8,0.000,26.667,3268,8,52,18.95,20.79,-1.85,-0.56518,2.45,15.91,108.93,55.04437
gemma-2-9b-it-8bit,30,0,26,4,0.000,13.333,2075,45,31,23.39,26.80,-3.41,-1.64413,21.69,14.94,69.17,58.12434
gpt-35-turbo-0125,30,0,30,0,0.000,0.000,86,90,0,39.00,39.00,0.00,0.00000,1046.51,0.00,2.87,82.02326
gpt-4-turbo-2024-04-09,30,0,2,28,0.000,93.333,5786,0,0,14.94,20.29,-5.35,-0.92524,0.00,0.00,192.87,6.03284
gpt-4o-2024-05-13,30,0,5,25,0.000,83.333,5596,1,3,11.68,15.91,-4.23,-0.75513,0.18,0.54,186.53,28.40654
gpt-4o-2024-08-06,30,0,3,27,0.000,90.000,5861,0,0,14.69,17.38,-2.69,-0.45911,0.00,0.00,195.37,6.57959
gpt-4o-mini-2024-07-18,30,0,12,18,0.000,60.000,4481,13,24,17.15,21.38,-4.23,-0.94480,2.90,5.36,149.37,108.21625
llama-3-70b-instruct-awq,30,0,15,15,0.000,50.000,4449,2,41,17.99,25.62,-7.63,-1.71560,0.45,9.22,148.30,41.60890
meta-llama-3.1-8b-instruct-fp16,30,0,30,0,0.000,0.000,830,19,61,34.70,35.29,-0.60,-0.71999,22.89,73.49,27.67,71.86024
Random Player (as White),1000,105,0,895,10.5,89.5,190073,0,0,10.56,11.08,-0.52,-0.00274,0.00,0.00,190.07,-
Random Player (as Black),1000,0,105,895,0.000,89.5,190073,0,0,11.08,10.56,0.52,0.00274,0.00,0.00,190.07,-
Stockfish chess engine (as Black),1000,1000,0,0,100.000,0.000,32368,0,0,38.21,21.01,17.21,0.53164,0.00,0.00,32.37,-
            `

        let currentSortOrder = {}; // To track the current sort order for each column
        const defaultSortColumnIndex = 1; // Sort by "Draws %" by default


        function showPane(paneId) {
            document.getElementById('leaderboard').style.display = paneId === 'leaderboard' ? 'block' : 'none';
            document.getElementById('how-it-works').style.display = paneId === 'how-it-works' ? 'block' : 'none';
            document.getElementById('considerations').style.display = paneId === 'considerations' ? 'block' : 'none';
            document.querySelectorAll('.button-container button').forEach(button => {
                button.classList.remove('selected');
            });
            document.querySelector(`.button-container button[onclick="showPane('${paneId}')"]`).classList.add('selected');
        }
        // !!!! Copy Paste aggregate results CSV here
        function fillTableWithCSV() {
            const lines = data.trim().split('\n');
            const header = lines[0].split(',');
            const rows = lines.slice(1).map(row => row.split(','));

            const csvIndices = {
                player: 0,
                player_wins_percent: 5,
                player_draws_percent: 6,
                wrong_actions_per_1000moves: 14,
                wrong_moves_per_1000moves: 15,
                completion_tokens_black_per_move: 17
            };

            // Separate the rows that should always be at the bottom
            const bottomRows = [];
            const otherRows = rows.filter(columns => {
                const player = columns[csvIndices.player];
                if (player === "Stockfish chess engine (as Black)" ||
                    player === "Random Player (as White)" ||
                    player === "Random Player (as Black)") {
                    bottomRows.push(columns);
                    return false;
                }
                return true;
            });

            // Sort the remaining rows by "Draws %" in descending order
            otherRows.sort((a, b) => {
                const drawsA = parseFloat(a[csvIndices.player_draws_percent]);
                const drawsB = parseFloat(b[csvIndices.player_draws_percent]);
                return drawsB - drawsA;
            });

            const tbody = document.querySelector('#leaderboard tbody');
            [...otherRows, ...bottomRows].forEach(columns => {
                const player = columns[csvIndices.player];
                const player_wins_percent = parseFloat(columns[csvIndices.player_wins_percent]);
                const player_draws_percent = parseFloat(columns[csvIndices.player_draws_percent]);
                const wrong_actions_per_1000moves = parseFloat(columns[csvIndices.wrong_actions_per_1000moves]);
                const wrong_moves_per_1000moves = parseFloat(columns[csvIndices.wrong_moves_per_1000moves]);
                const mistakes = wrong_actions_per_1000moves + wrong_moves_per_1000moves;
                const tokens = parseFloat(columns[csvIndices.completion_tokens_black_per_move]);

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${player}</td> <!-- Player first -->
                    <td>${player_draws_percent.toFixed(2)}%</td> <!-- Draws second -->
                    <td>${player_wins_percent.toFixed(2)}%</td>
                    <td>${mistakes.toFixed(2)}</td>
                    <td>${tokens.toFixed(2)}</td>
                `;
                tbody.appendChild(tr);
            });

            // Add a non-breaking space to all headers
            document.querySelectorAll('#leaderboard th').forEach((headerCell) => {
                const baseText = headerCell.textContent.trim();
                headerCell.innerHTML = `${baseText}&nbsp;&nbsp;`;
            });
            const materialAdvantageHeader = document.querySelectorAll('#leaderboard th')[1];
            const defaultSortColumnIndex = 1; // Assuming this is defined above
            const defaultSortHeader = document.querySelectorAll('#leaderboard th')[defaultSortColumnIndex];
            defaultSortHeader.innerHTML = `${defaultSortHeader.textContent.trim()}&nbsp;▼`;
            document.querySelectorAll('#leaderboard th').forEach((headerCell, index) => {
                headerCell.addEventListener('click', () => {
                    sortTable(index);
                });
            });
        }

        function sortTable(columnIndex) {
            const table = document.querySelector('#leaderboard tbody');
            const rows = Array.from(table.rows);
            const isNumericColumn = columnIndex !== 0; // Assuming first column is not numeric

            // Determine the current sort order for the column
            const currentOrder = currentSortOrder[columnIndex] || 'asc';
            const newOrder = currentOrder === 'asc' ? 'desc' : 'asc';
            currentSortOrder[columnIndex] = newOrder;

            // Separate the rows that should always be at the bottom
            const bottomRows = [];
            const otherRows = rows.filter(row => {
                const player = row.cells[0].textContent;
                if (player === "Stockfish chess engine (as Black)" ||
                    player === "Random Player (as White)" ||
                    player === "Random Player (as Black)") {
                    bottomRows.push(row);
                    return false;
                }
                return true;
            });

            otherRows.sort((a, b) => {
                const aText = a.cells[columnIndex].textContent;
                const bText = b.cells[columnIndex].textContent;

                const comparison = isNumericColumn
                    ? parseFloat(aText) - parseFloat(bText)
                    : aText.localeCompare(bText);

                return newOrder === 'asc' ? comparison : -comparison;
            });

            // Append sorted rows and then the bottom rows
            [...otherRows, ...bottomRows].forEach(row => table.appendChild(row));

            // Clear all sort indicators
            document.querySelectorAll('#leaderboard th').forEach((headerCell) => {
                const baseText = headerCell.textContent.replace(/[▲▼]/g, '').trim();
                headerCell.innerHTML = `${baseText}&nbsp;&nbsp;`;
            });

            // Update header text with sorting indicator for the sorted column
            const sortedHeaderCell = document.querySelectorAll('#leaderboard th')[columnIndex];
            const baseText = sortedHeaderCell.textContent.replace(/[▲▼]/g, '').trim();
            const indicator = currentSortOrder[columnIndex] === 'asc' ? '▲' : '▼';
            sortedHeaderCell.innerHTML = `${baseText}${indicator ? '&nbsp;' + indicator : '&nbsp;&nbsp;'}`;
        }
        document.addEventListener('DOMContentLoaded', () => {
            fillTableWithCSV();
            fetchAndAnimateBoard();
            // Set initial sort order for the default column
            currentSortOrder[defaultSortColumnIndex] = 'desc'; // Assuming "Draws %" is the second column
        });

        function fetchAndAnimateBoard() {
            fetch('moves.txt')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    const boardStates = data.trim().split('-\n');
                    let currentIndex = 0;

                    let interval = 1000; // Initial interval in milliseconds
                    let resetGameInterval = 7000;

                    function animateBoard() {
                        document.querySelector('pre.board').textContent = boardStates[currentIndex].trim();
                        document.querySelector('div.game-over').style.display = 'none';
                        currentIndex = (currentIndex + 1) % boardStates.length;

                        if (currentIndex === 0) {
                            document.querySelector('div.game-over').style.display = 'block';
                            currentIndex = 0;
                            setTimeout(animateBoard, resetGameInterval);
                        } else {
                            // Decrease the interval progressively
                            interval = Math.max(50, interval - 25); // Decrease by 25ms, but not less than 50ms
                            setTimeout(animateBoard, interval);
                        }
                    }

                    animateBoard(); // Start the animation
                })
                .catch(error => {
                    console.error('Error fetching moves.txt:', error);
                });
        }
    </script>
</head>
<body>
    <div class="center">
        <a class="gh" href="https://github.com/maxim-saplin/llm_chess" target="_blank" hidden="true"><img src="gh.png" width="48"/></a>
        <pre class="title">
 __       __                    ____     __                               
/\ \     /\ \       /'\_/`\    /\  _``. /\ \                              
\ \ \    \ \ \     /\      \   \ \ \/\_\\ \ \___      __    ____    ____  
 \ \ \  __\ \ \  __\ \ \__\ \   \ \ \/_/_\ \  _ `\  /'__`\ /',__\  /',__\ 
  \ \ \L\ \\ \ \L\ \\ \ \_/\ \   \ \ \L\ \\ \ \ \ \/\  __//\__, `\/\__, `\
   \ \____/ \ \____/ \ \_\\ \_\   \ \____/ \ \_\ \_\ \____\/\____/\/\____/
    \/___/   \/___/   \/_/ \/_/    \/___/   \/_/\/_/\/____/\/___/  \/___/ 

        </pre>
        <pre class="title-narrow">
 __         __         __    __                        
/\ \       /\ \       /\ "-./  \                       
\ \ \____  \ \ \____  \ \ \-./\ \                      
 \ \_____\  \ \_____\  \ \_\ \ \_\                     
  \/_____/   \/_____/   \/_/  \/_/                     
                                                                   
 ______     __  __     ______     ______     ______    
/\  ___\   /\ \_\ \   /\  ___\   /\  ___\   /\  ___\   
\ \ \____  \ \  __ \  \ \  __\   \ \___  \  \ \___  \  
 \ \_____\  \ \_\ \_\  \ \_____\  \/\_____\  \/\_____\ 
  \/_____/   \/_/\/_/   \/_____/   \/_____/   \/_____/ 
        </pre>
        <p class="intro">
            Can a Large Language Model play chess? You can prompt it to make
            a move based on the board state, hint it with legal moves. You will find that 
            an LLM can move pieces, even provide sound comments on why it made a certain move
            and what tactic or strategy it followed.
            <br/><br/>
            But can LLMs actually make any meaningful moves and win in a chess game? Why don't
            we put them up against a random player (i.e., a bot that randomly picks any move from a list of 
            legal moves for the current position). After all, the models are called Foundational Models for
            a reason; they have the knowledge of the entire Internet, can (supposedly) reason, and pass
            numerous math evaluations and PhD-level exams. What could be easier for an LLM than to score a victory over
            a chaos monkey?
            <br/><br/>
            Let's find out ツ
        </p>
        Random Player (White)
        <div class="board">
            <pre class="board">
♜ ♞ ♝ ♛ ♚ ♝ ♞ ♜
♟ ♟ ♟ ♟ ♟ ♟ ♟ ♟
o o o o o o o o
o o o o o o o o
o o o ♙ o o o o
o o o o o o o o
♙ ♙ ♙ o ♙ ♙ ♙ ♙
♖ ♘ ♗ ♕ ♔ ♗ ♘ ♖</pre>
            <div class="game-over">
                <p>GAME OVER</p>
                <span>
                    - Outcome: Draw </br>
                    - Max moves reached: 200 </br>
                    - Material White: 16 </br>
                    - Material Black: 18
                </span>
            </div>
        </div>
        GPT-4o Mini (Black)
        <div class="button-container">
            <button class="selected" onclick="showPane('leaderboard')">Leaderboard</button>
            <button onclick="showPane('how-it-works')">How it works</button>
            <button onclick="showPane('considerations')">Considerations</button>
        </div>
        <div id="leaderboard" class="pane">
            <div class="table-container">
                <table border="0">
                    <thead>
                        <tr>
                            <th>Player&nbsp;&nbsp;</th> <!-- Player first -->
                            <th>Draws %&nbsp;&nbsp;</th> <!-- Draws second -->
                            <th>Wins %&nbsp;&nbsp;</th>
                            <th>Mistakes&nbsp;&nbsp;</th>
                            <th>Tokens&nbsp;&nbsp;</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
        <div id="how-it-works" class="pane" style="display: none;">
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
        </div>
        <div id="considerations" class="pane" style="display: none;">
            <p>Here you can add any considerations or notes about the LLM chess project.</p>
        </div>
    </div>
</body>
</html>
